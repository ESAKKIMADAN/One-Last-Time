var y=Object.defineProperty;var m=(a,e,t)=>e in a?y(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var s=(a,e,t)=>m(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const r of h)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(h){const r={};return h.integrity&&(r.integrity=h.integrity),h.referrerPolicy&&(r.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?r.credentials="include":h.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(h){if(h.ep)return;h.ep=!0;const r=t(h);fetch(h.href,r)}})();class p{constructor(){s(this,"keys",{});window.addEventListener("keydown",e=>{this.keys[e.code]=!0}),window.addEventListener("keyup",e=>{this.keys[e.code]=!1})}isDown(e){return!!this.keys[e]}}class d{constructor(e,t,i,h){s(this,"x");s(this,"y");s(this,"width");s(this,"height");this.x=e,this.y=t,this.width=i,this.height=h}}var o=(a=>(a.IDLE="idle",a.RUN="run",a.JUMP="jump",a.FALL="fall",a.SHOOT="shoot",a.RUN_SHOOT="run_shoot",a))(o||{});class w extends d{constructor(t,i){super(t,i,64,128);s(this,"velocityX",0);s(this,"velocityY",0);s(this,"gravity",.5);s(this,"jumpStrength",-12);s(this,"speed",4);s(this,"grounded",!1);s(this,"facing",1);s(this,"lastShotTime",0);s(this,"fireRate",250);s(this,"images",[]);s(this,"gameFrame",0);s(this,"staggerFrames",7);s(this,"currentFrameIndex",0);s(this,"state",o.IDLE);s(this,"animationMap",{[o.IDLE]:[1],[o.RUN]:[2,3,4,5,6],[o.JUMP]:[7],[o.FALL]:[8],[o.SHOOT]:[10,11,12,12],[o.RUN_SHOOT]:[11]});for(let h=1;h<=12;h++){const r=new Image;r.src=`assets/player/${h}.png`,this.images[h]=r}}update(t,i){const h=t/16.666666666666668;let r=!1,n=!1;(i.isDown("KeyF")||i.isDown("KeyJ"))&&(n=!0),this.velocityX=0,(i.isDown("KeyA")||i.isDown("ArrowLeft"))&&(this.velocityX=-this.speed,this.facing=-1,r=!0),(i.isDown("KeyD")||i.isDown("ArrowRight"))&&(this.velocityX=this.speed,this.facing=1,r=!0),(i.isDown("Space")||i.isDown("KeyW")||i.isDown("ArrowUp"))&&this.grounded&&(this.velocityY=this.jumpStrength,this.grounded=!1),this.velocityY+=this.gravity*h,this.x+=this.velocityX*h,this.y+=this.velocityY*h,this.y+this.height>400&&(this.y=400-this.height,this.velocityY=0,this.grounded=!0),n?this.state=o.SHOOT:this.grounded?r?this.state=o.RUN:this.state=o.IDLE:this.velocityY>=0?this.state=o.FALL:this.state=o.JUMP,this.gameFrame++;const l=this.animationMap[this.state];if(l&&l.length>0){const f=Math.floor(this.gameFrame/this.staggerFrames)%l.length;this.currentFrameIndex=l[f]}else this.currentFrameIndex=1;return null}shoot(t){return t-this.lastShotTime>this.fireRate?(this.lastShotTime=t,{x:this.x+(this.facing===1?this.width:0),y:this.y+40,dir:this.facing}):null}draw(t){const i=this.images[this.currentFrameIndex];if(!i)return;const h=Math.floor(this.x),r=Math.floor(this.y),n=i.naturalWidth||128,l=i.naturalHeight||144,f=(n-this.width)/2,g=l-this.height;t.save(),this.facing===-1?(t.scale(-1,1),t.drawImage(i,-h-this.width-f,r-g)):t.drawImage(i,h-f,r-g),t.restore()}}class x extends d{constructor(t,i,h){super(t,i,8,8);s(this,"speed");s(this,"active",!0);s(this,"direction");this.direction=h,this.speed=10}update(t){const i=t/16.666666666666668;this.x+=this.speed*this.direction*i,(this.x<-50||this.x>2e3)&&(this.active=!1)}draw(t){t.fillStyle="#ffeb3b",t.fillRect(Math.floor(this.x),Math.floor(this.y),this.width,this.height)}}class v extends d{constructor(t,i){super(t,i,64,128);s(this,"speed",2);s(this,"direction",1);s(this,"startX");s(this,"patrolRange",200);s(this,"health",3);s(this,"active",!0);this.startX=t}update(t){const i=t/16.666666666666668;this.x+=this.speed*this.direction*i,this.x>this.startX+this.patrolRange?this.direction=-1:this.x<this.startX-this.patrolRange&&(this.direction=1)}draw(t){t.fillStyle="#ef4444",t.fillRect(Math.floor(this.x),Math.floor(this.y),this.width,this.height),t.fillStyle="#fff",this.direction===1?t.fillRect(Math.floor(this.x+20),Math.floor(this.y+10),4,4):t.fillRect(Math.floor(this.x+8),Math.floor(this.y+10),4,4)}takeDamage(t){this.health-=t,this.health<=0&&(this.active=!1)}}class S{constructor(e,t){s(this,"canvas");s(this,"ctx");s(this,"lastTime",0);s(this,"bgImage");s(this,"input");s(this,"player");s(this,"bullets",[]);s(this,"enemies",[]);s(this,"gameState",0);this.canvas=e,this.ctx=t,this.input=new p,this.player=new w(100,300),this.bgImage=new Image,this.bgImage.src="assets/background.jpg",this.spawnEnemy(500,272),this.spawnEnemy(700,272)}start(){requestAnimationFrame(this.gameLoop.bind(this))}spawnEnemy(e,t){this.enemies.push(new v(e,t))}gameLoop(e){const t=e-this.lastTime;this.lastTime=e,this.update(t,e),this.draw(),requestAnimationFrame(this.gameLoop.bind(this))}update(e,t){if(this.gameState===0){(this.input.isDown("Enter")||this.input.isDown("Space"))&&(this.gameState=1);return}if(this.player.update(e,this.input),this.input.isDown("KeyF")||this.input.isDown("KeyJ")){const i=this.player.shoot(t);i&&this.bullets.push(new x(i.x,i.y,i.dir))}this.bullets.forEach(i=>i.update(e)),this.bullets=this.bullets.filter(i=>i.active),this.enemies.forEach(i=>i.update(e)),this.enemies=this.enemies.filter(i=>i.active),this.checkCollisions()}checkCollisions(){for(const e of this.bullets)for(const t of this.enemies)e.active&&t.active&&this.isColliding(e,t)&&(e.active=!1,t.takeDamage(1));for(const e of this.enemies)e.active&&this.isColliding(this.player,e)&&(this.player.x=0,console.log("Player hit!"))}isColliding(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}draw(){if(this.ctx.fillStyle="#202020",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.bgImage.complete&&this.ctx.drawImage(this.bgImage,0,0,this.canvas.width,this.canvas.height),this.gameState===0){this.ctx.fillStyle="#202020",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.textAlign="center",this.ctx.fillStyle="#FFFAFA",this.ctx.font='40px "Press Start 2P"',this.ctx.fillText("ONE LAST TIME",this.canvas.width/2,this.canvas.height/2-50),this.ctx.font='20px "Press Start 2P"',this.ctx.fillText("PRESS ENTER TO START",this.canvas.width/2,this.canvas.height/2+50);return}this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,400,this.canvas.width,this.canvas.height-400),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,400),this.ctx.lineTo(this.canvas.width,400),this.ctx.stroke(),this.player.draw(this.ctx),this.bullets.forEach(e=>e.draw(this.ctx)),this.enemies.forEach(e=>e.draw(this.ctx)),this.ctx.fillStyle="#fff",this.ctx.font='16px "Press Start 2P"',this.ctx.textAlign="left",this.ctx.fillText("F: Shoot",10,30)}}const c=document.getElementById("gameCanvas"),u=c.getContext("2d");c&&u?(c.width=800,c.height=450,new S(c,u).start()):console.error("Canvas not found!");
